<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>NICEPAY PAY REQUEST(UTF-8)</title>
    <meta charset="utf-8">
    <style>
        html,body {height: 100%;}
        form {overflow: hidden;}
    </style>

</head>
<body>
<form name="payForm" method="post" action="/payment/check">
    <table>
        <tr>
            <!-- <th><span>결제 수단</span></th> -->
            <td><input  name="PayMethod" th:value="CARD"></td>
        </tr>
        <tr>
            <!-- <th><span>결제 상품명</span></th> -->
            <td><input  name="GoodsName" th:value="${goodsName}"></td>
        </tr>
        <tr>
            <!--  <th><span>결제 상품금액</span></th> -->
            <td><input  name="Amt" th:value="${price}"></td>
        </tr>
        <tr>
            <!-- <th><span>상점 아이디</span></th> -->
            <td><input  name="MID" th:value="${merchantID}"></td>
        </tr>
        <tr>
            <!--  <th><span>상품 주문번호</span></th> -->
            <td><input  name="Moid" th:value="${moid}"></td>
        </tr>
        <tr>
            <!-- <th><span>구매자명</span></th> -->
            <td><input  name="BuyerName" th:value="${buyerName}"></td>
        </tr>
        <tr>
            <!-- <th><span>구매자 연락처</span></th> -->
            <td><input  name="BuyerTel" th:value="${buyerTel}"></td>
        </tr>
        <tr>
            <!-- <th><span>인증완료 결과처리 URL(모바일 결제창 전용)PC 결제창 사용시 필요 없음</span></th> -->
            <td><input  name="ReturnURL" th:value="${returnURL}"></td>
        </tr>
        <!--<tr>
            <td><input  name="Period" th:value="${period}"></td>
        </tr>-->
        <input type="hidden" name="GoodsCl" th:value="${goodsCl}"/>
        <input type="hidden" name="TransType" th:value="${transType}"/>
        <input type="hidden" name="CharSet" th:value="${charSet}"/>
        <input type="hidden" name="ReqReserved" th:value="${reqReserved}"/>
        <input  name="EdiDate" th:value="${ediDate}"/>
        <input  name="SignData" th:value="${signData}"/>
        <!-- <input type="hidden" name="userId" th:value="${userId}"/> -->
    </table>
     <a href="#" class="btn_blue" onClick="nicepayStart();">요 청</a>
</form>
<script src="https://web.nicepay.co.kr/v3/webstd/js/nicepay-3.0.js" type="text/javascript"></script>
<script type="text/javascript">
    //결제창 최초 요청시 실행됩니다.
    function nicepayStart(){
        if(checkPlatform(window.navigator.userAgent) == "mobile"){//모바일 결제창 진입
            document.payForm.action = "https://web.nicepay.co.kr/v3/v3Payment.jsp";
            document.payForm.acceptCharset="euc-kr";
            document.payForm.submit();
        }else{//PC 결제창 진입
            goPay(document.payForm);
        }
    }

    //[PC 결제창 전용]결제 최종 요청시 실행됩니다. <<'nicepaySubmit()' 이름 수정 불가능>>
    function nicepaySubmit(){
        document.payForm.submit();
    }

    //[PC 결제창 전용]결제창 종료 함수 <<'nicepayClose()' 이름 수정 불가능>>
    function nicepayClose(){
        alert("결제가 취소 되었습니다");

        // Moid 값을 가져옵니다.
        var moidValue = document.payForm.Moid.value;

        // Moid 값을 URL에 동적으로 적용합니다.
        // window.location.href = "http://210.180.118.201:8500/payment/" + moidValue;
    }

    //pc, mobile 구분(가이드를 위한 샘플 함수입니다.)
    function checkPlatform(ua) {
        if(ua === undefined) {
            ua = window.navigator.userAgent;
        }

        ua = ua.toLowerCase();
        var platform = {};
        var matched = {};
        var userPlatform = "pc";
        var platform_match = /(ipad)/.exec(ua) || /(ipod)/.exec(ua)
            || /(windows phone)/.exec(ua) || /(iphone)/.exec(ua)
            || /(kindle)/.exec(ua) || /(silk)/.exec(ua) || /(android)/.exec(ua)
            || /(win)/.exec(ua) || /(mac)/.exec(ua) || /(linux)/.exec(ua)
            || /(cros)/.exec(ua) || /(playbook)/.exec(ua)
            || /(bb)/.exec(ua) || /(blackberry)/.exec(ua)
            || [];

        matched.platform = platform_match[0] || "";

        if(matched.platform) {
            platform[matched.platform] = true;
        }

        if(platform.android || platform.bb || platform.blackberry
                || platform.ipad || platform.iphone
                || platform.ipod || platform.kindle
                || platform.playbook || platform.silk
                || platform["windows phone"]) {
            userPlatform = "mobile";
        }

        if(platform.cros || platform.mac || platform.linux || platform.win) {
            userPlatform = "pc";
        }

        return userPlatform;

    }
    window.onload = function() {
        // nicepayStart();
    };
</script>
</body>
</html>
