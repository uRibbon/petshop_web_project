<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Products detail</title>
    <link th:href="@{/css/main.css}" rel="stylesheet">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            height: 100vh;
            place-items: center;
            background-color: #f6f6f6;
        }
        .product-container {
            width: 95%;
            border: 1px solid #e0e0e0;
            padding: 2em;
            display: flex;
            margin: 2em auto;
            background-color: #fff;
        }
        .product-image {
            flex: 2;
            margin-right: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .product-image img {
            max-width: 80%;
        }
        .product-info {
            flex: 2;
            display: flex;
            flex-direction: column;
            align-items: start;
        }
        .product-title {
            font-size: 24px;
            margin-bottom: 20px;
            color: #333;
            position: relative;
        }
        .product-title::after {
            content: "";
            position: absolute;
            bottom: -10px;
            left: 0;
            width: 100%;
            height: 2px;
            /*background: rgba(0, 0, 0, 0.1); !* 반투명 선 *!*/
        }
        .product-price {
            font-size: 20px;
            margin-bottom: 10px;
            color: #0f6674;
        }
        .product-original-price {
            font-size: 16px;
            text-decoration: line-through;
            color: #aaa;
            margin-bottom: 20px;
        }
        .product-option {
            margin-bottom: 20px;
        }
        .button {
            padding: 20px 30px;
            border: none;
            cursor: pointer;
            margin-right: 10px;
            text-decoration: none; /* 밑줄 제거 */
        }
        .add-to-cart {
            background-color: #000; /* 검은색 */
            color: #fff; /* 흰색 */
        }
        .purchase {
            background-color: #fff; /* 흰색 */
            color: #000; /* 검은색 */
            border: 1px solid #000; /* 검은색 테두리 */
        }
        .payment-info {
            background-color: #4CAF50;
            color: #fff;
            padding: 10px;
            margin-top: 20px;
        }
        button[type="button"] {
            border-radius: 50%; /* 동그란 모양 */
            width: 30px; /* 버튼 크기 */
            height: 30px;
            font-weight: bold; /* 글씨 굵게 */
            background-color: #f5f5f5; /* 배경색 */
            border: 1px solid #ddd; /* 테두리 색 */
            align-items: center; /* 수직 중앙 정렬 */
            justify-content: center; /* 수평 중앙 정렬 */
            cursor: pointer; /* 마우스 포인터 변경 */
        }
        input[type="number"] {
            width: 50px; /* 길이를 짧게 설정 */
            padding: 5px; /* 안쪽 패딩 */
            text-align: center; /* 텍스트 중앙 정렬 */
            border: 1px solid #ddd; /* 테두리 색 */
            margin: 0 5px; /* 좌우 마진 설정 */
        }
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .detail {
            text-align: center;
        }
        .notice {
            text-align: center;
        }
         .review {
             max-width: 93%;
             margin: auto;
             /*text-align: center;*/
         }

        .review ul {
            list-style-type: none;
            padding: 0;
            background-color: #f9f9f9;
            padding: 20px;
        }

        .review li {
            background-color: #f9f9f9;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .review h5.rating::before {
            content: "★★★★★";
            letter-spacing: 3px;
            opacity: 0.3;
        }

        .review h5.rating[data-rating="4"]::before {
            content: "★★★★☆";
        }

        /* 별점에 다른 스타일을 적용하려면 이와 같이 추가하세요. */
        .review h5.rating[data-rating="3"]::before {
            content: "★★★☆☆";
        }

        .review h5.rating[data-rating="2"]::before {
            content: "★★☆☆☆";
        }

        .review h5.rating[data-rating="1"]::before {
            content: "★☆☆☆☆";
        }
        h2 {
            border-bottom: 1px solid rgba(0, 0, 0, 0.2); /* 이 부분은 투명도를 조절합니다. 0.1은 10% 투명도를 의미합니다. */
            padding-bottom: 5px; /* 제목 아래의 여백을 추가합니다. */
            margin-bottom: 10px; /* 선 아래의 여백을 추가합니다. */
        }
    </style>
</head>
<body>
<div th:insert="~{/index/header :: header}"></div>
<div class="product-container">
    <div class="product-image">
        <img th:if="${product.mainImageUrl != null}" th:src="${product.mainImageUrl}" alt="Product image"/>
        <img th:unless="${product.mainImageUrl != null}" src="/img/icon/product_list/product_01.jpeg" alt="No image available"/>
    </div>

    <div class="product-info">
        <h2 class="product-title" th:text="${product.productName}"></h2>
        <p th:text="${'수량 ' + product.stock}"></p>
        <p th:text="${product.description}"></p>
        <h3 class="product-price" th:text="${'판매가 ' + product.price + '원'}"></h3>
        </br>
        <!-- 폼 내용 코드 -->
        <form id="yourFormId" action="#" th:action="@{/cartItem/addcartItem}" th:object="${multiFormDto}" method="post" onsubmit="return false;">

</br>
            <button type="button" onclick="decreaseQuantity()">━</button>
            <input type="number" th:field="*{cartItemReqDto.quantity}" id="cartItemReqDto.quantity" oninput="calculateSubtotal()">
            <span th:if="${#fields.hasErrors('cartItemReqDto.quantity')}" th:errors="*{cartItemReqDto.quantity}"></span>
            <button type="button" onclick="increaseQuantity()">╊</button>
            <br/>
            </br>

            </br>
            <span id="cartItemReqDto.subTotal"></span>
            </br>
            <br/>
            </br>

            <label for="productResDTO.price"></label>
            <input type="hidden" th:field="*{productResDTO.price}" id="productResDTO.price" readonly>
            <!--cart_id는 이용자들이 볼 필요가 없어서 hidden 처리후 br 제거해서 줄 병합-->
            <label for="cartResDto.id"><!--cart_id--></label>
            <input type="hidden" th:field="*{cartResDto.id}" id="cartResDto.id">
            <!--proudct_id 도 이용자들이 볼 필요가 없어서 hidden 처리후 br 제거해서 줄 병합-->
            <label for="productResDTO.id"><!--product_id--></label>
            <input type="hidden" th:field="*{productResDTO.id}" id="productResDTO.id">
            
            <label for="productResDTO.stock"><!--product_id--></label>
            <input type="hidden" th:field="*{productResDTO.id}" id="productResDTO.stock">


        </form>
</br>
        <div>
<!--            <a th:if="${product.salesStatus != '품절'}" th:href="@{/cartItem/signup/{id}(id=${product.id})}" class="button add-to-cart">장바구니 담기</a>-->
<!--            <a th:if="${product.salesStatus != '품절'}" th:href="@{/cartItem/signup/{id}(id=${product.id}, stock=${product.stock})}" class="button add-to-cart">장바구니 담기</a>-->
            <a th:if="${product.salesStatus != '품절'}" onclick="updateLinkWithQuantity();" th:href="@{/cartItem/signup/{id}(id=${product.id})}" id="addToCartLink" class="button add-to-cart">장바구니 담기</a>
            <span th:if="${product.salesStatus == '품절'}" style="color: red;">품절된 상품입니다.</span>

            <a th:href="@{/api/inquiry/register/{id}(id=${product.id})}" class="button purchase">상품 문의하기</a>
        </div>
        </br>
    </div>
</div>

<div th:if="${reviews.isEmpty()}">
    <p></p>
</div>
<div th:each="review : ${reviews}">
    <div class="review-card">
        <h3 th:text="${review.title}">Review Title</h3>
        <p th:text="${review.content}">Review Content</p>
        <p><strong>User:</strong> <span th:text="${review.user.name}">User Name</span></p>
        <p><strong>Status:</strong> <span th:text="${review.reviewStatus}">Review Status</span></p>
    </div>
</div>
<nav><h1>　　　　　　상품정보</h1></nav>
<h3></h3>
<article class="detail">
    <img src="/test/test2.jpg" alt="상세페이지1">
    <img src="/test/test3.jpg" alt="상세페이지2">
    <img src="/test/test4.jpg" alt="상세페이지3">
</article>

<article class="review">
    <nav><h1>　상품리뷰</h1></nav>
    <h3></h3>
    <ul>
            <h2></h2>
            <div>
                <h5 class="rating" data-rating="5"></h5>
                <span>유*미　2023-10-14</span>
            </div>
            <h3>베니즈 베이직 하네스/퍼플/M</h3>
            <img src="/review/review1.jpg" alt="" width="100" height="100">
            <img src="/review/review2.jpg" alt="" width="100" height="100">
            <p>어떤옷이든 찰떡입니다
                </br></br>
                비숑인데 다른하네스는 어깨가 꽉껴서 불편해하는데</br>
                요건 더저렴하면서 편해하더라구요</br>
                끼이지도않고</br>
                면이 부드러워서 좋아요</br>
                어떤옷을입어도 잘어울리네요</p>
       <h2></h2>
        <!-- 다른 리뷰 항목도 같은 방식으로 추가 -->
            <div>
                <h5 class="rating" data-rating="4"></h5>
                <span>장*희　2023-10-06</span>
            </div>
            <h3>베니즈 베이직 하네스/옐로우/S</h3>
            <p>너무 좋아요
                </br></br>
                첫째 강아지가 여기서 하네스를 샀는데 너무 좋아서 둘째 강아지도 여기서 하네스를 샀어요.
                허내수 단품치고는 비싼 편이지만 겨울에도 하네스 끈을 늘릴수있어 두꺼운 옷에도 하네스를 할수있고
                가장 중요한 강아지들이 편해해요. 둘째 강아지가 저번에 하네스가 산책 중에 벗겨져서 놀라서 서둘러서
                이 하네스를 샀는데 너무 좋아요 발이 빠지지도 않아서 하네스가 벗겨지지 않아서 안심이고 디자인도
                이뻐서 정말 여기서 산게 후회가 안돼요!!
            </p>
            <h2></h2>

        <div>
            <h5 class="rating" data-rating="3"></h5>
            <span>김*주　2023-07-07</span>
        </div>
        <h3>베니즈 베이직 하네스/라이트핑크/M</h3>
        <img src="/review/review3.jpg" alt="" width="100" height="100">
        <p>리드줄과 세트로 사면 이뻐용
            </br></br>
            리드줄과 세트로 샀는데요 강아지한테 입힐때 줄을 늘리면 돼서 편하지만 늘리는 부분이 쇠버클을
            늘렸다가 조이는 형태로 돼 있는데 털이 자주 끼어서 조심해야돼요ㅠㅠ 그리고 리드줄과 연결하는
            고리가 무거운데 또 길어서 하네스만 입혀놓으면 강아지가 뛰놀면서 고리가 좀 위험할거같아요...
            색은 너무 이쁘고 맘에드는데 리드줄끼우는 고리를 짧게해주던지 바꾸셔야될거같아요
        </p>
        <h2></h2>
    </ul>
</article>

<div th:insert="~{/index/footer :: footer}"></div>

<script th:inline="javascript">

    function updateLinkWithQuantity() {
        var quantity = document.getElementById("cartItemReqDto.quantity").value;
        var link = document.getElementById("addToCartLink");
        var baseUrl = link.href;  // 실제 href 값을 가져옵니다.
        link.href = baseUrl + "?stock=" + quantity;  // 수량을 URL에 추가합니다.
    }


    /*<![CDATA[*/
    function increaseQuantity() {
        var quantity = parseInt(document.getElementById("cartItemReqDto.quantity").value);
        quantity += 1;
        document.getElementById("cartItemReqDto.quantity").value = quantity;
        calculateSubtotal();
    }

    function decreaseQuantity() {
        var quantity = parseInt(document.getElementById("cartItemReqDto.quantity").value);
        quantity -= 1;
        if (quantity >= 0) {
            document.getElementById("cartItemReqDto.quantity").value = quantity;
            calculateSubtotal();
        } else {
            alert("상품은 최소 1개 이상 선택해야 합니다.");
        }
    }

    window.onload = calculateSubtotal;
    function calculateSubtotal() {
        var quantity = document.getElementById("cartItemReqDto.quantity").value;
        var unitPrice = document.getElementById("productResDTO.price").value;

        if (!isNaN(quantity) && !isNaN(unitPrice)) {
            var subtotal = quantity * unitPrice;
            // document.getElementById("cartItemReqDto.subTotal").value = subtotal;
            document.getElementById("cartItemReqDto.subTotal").textContent = "총 상품금액: " + subtotal + "원"; //원화 표시를 추가했습니다.
        } else {
            alert("유효한 숫자가 아닙니다.");
        }
    }

    document.getElementById("submitButton").onclick = function () {
        document.getElementById("yourFormId").submit();
    };
    /*]]>*/
</script>

</body>
</html>
<!--            <label for="cartItemReqDto.quantity">수량</label>-->
<!--            <label for="cartItemReqDto.subTotal">합계 금액</label>-->
<!--            <div class="button-container">-->

<!--&lt;!&ndash;                <button id="submitButton">장바구니 담기</button>&ndash;&gt;-->
<!--            </div>-->